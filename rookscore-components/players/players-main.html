<!DOCTYPE html>
<link rel="import" href="../../rookscore-styles.html">
<link rel="import" href="../../imports.html">

<dom-module id="players-main">

    <style is="custom-style" include="rookscore-styles">
        :host {
            --paper-dialog: {
                margin: 10px;
            }
            ;
            --paper-dialog-scrollable: {
                padding: 3px;
            }
            ;
        }
        
        .dialog-title {
            @apply(--paper-font-subhead);
        }
    </style>

    <template>

        <player-controller id="playerController" values="{{players}}" db="[[db]]"></player-controller>

        <paper-dialog id="addPlayerDialog">
            <paper-dialog-scrollable class="rookscore-dialog">
                <paper-material class="rookscore-dialog-content">
                    <div class="dialog-title">Add Player</div>
                    <paper-input id="playerFirstname" label="First Name" value="{{firstName}}"></paper-input>
                    <paper-input id="playerLastname" label="Last Name" value="{{lastName}}"></paper-input>
                </paper-material>
            </paper-dialog-scrollable>
            <div class="buttons">
                <paper-button on-click="doCancel">Cancel</paper-button>
                <paper-button on-click="doAdd" disabled="{{addButtonDisabled(firstName, lastName)}}">Add</paper-button>
            </div>
        </paper-dialog>


        <iron-list items="[[players]]" as="player">
            <template>
                <selectable-player class="rookscore-list-item" player="[[player]]"></selectable-player>
            </template>
        </iron-list>


        <paper-fab class="rookscore-fab" icon="icons:add" on-click="addPlayerClicked"></paper-fab>


    </template>


    <script>
        Polymer({
            is: "players-main",



            addButtonDisabled: function() {
                if (!this.firstName || !this.lastName) {
                    return true;
                }

                for (var i = 0; i < this.players.length; i++) {
                    if (this.players[i].first_name === this.firstName && this.players[i].last_name === this.lastName) {
                        return true;
                    }
                }

                return false;

            },


            addPlayerClicked: function() {
                this.$.addPlayerDialog.open();
            },

            doCancel: function() {
                this.$.addPlayerDialog.close();
            },

            doAdd: function() {
                //validation
                if (this.firstName && this.lastName) {
                    this.$.playerController.add({
                        'first_name': this.firstName,
                        'last_name': this.lastName
                    });

                    //clear input
                    this.firstName = null;
                    this.lastName = null;

                    this.$.addPlayerDialog.close();
                }

            }
        });
    </script>

</dom-module>
