<!DOCTYPE html>
<link rel="import" href="../../imports.html">
<link rel="import" href="../index-db/object-store-controller.html">
<!-- 
Example of player schema player_id is the key I may use locally 
{ player_id: 1234, id: 2, first_name: "Chris", last_name: "Pope" }, 
-->



<dom-module id="index-db">

    <script>
        Polymer({
            is: "index-db",


            properties: {
                db: {
                    type: Object,
                    notify: true
                },

                CURRENT_VERSION: {
                    type: Number,
                    readOnly: true,
                    value: 6
                },
            },



            ready: function() {
                var that = this;

                var request = window.indexedDB.open("Rookscore", this.CURRENT_VERSION);
                request.onsuccess = function(event) {
                    that.db = event.target.result
                };

                request.onerror = function(event) {
                    console.log("DB Error " + event);
                    //throw error - we are unable to use the app without successfully opening the DB
                };

                request.onupgradeneeded = function(event) {
                    console.log("upgrade needed");

                    var db = event.target.result;


                    if (event.oldVersion < 3) {
                        db.createObjectStore(ObjectStoreController.PLAYER_OBJECT_STORE_NAME, {
                            keyPath: "player_id",
                            autoIncrement: true
                        });
                    }


                    if (event.oldVersion < 6) {
                        db.createObjectStore(ObjectStoreController.GAME_OBJECT_STORE_NAME, {
                            keyPath: "game_id",
                            autoIncrement: true
                        });
                    }


                    db.transaction.oncomplete = function() {
                        that.db = db;
                    };

                };
            }
        });
    </script>
</dom-module>
